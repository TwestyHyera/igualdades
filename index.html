<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Juego: Igualdad de Oportunidades</title>
  <meta name="description" content="Mini-juego educativo sobre igualdad vs equidad. Empareja recursos para que todos lleguen a la meta.">
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#7dd3fc; --muted:#94a3b8; --success:#34d399; --danger:#fb7185;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:#e6eef6;background:linear-gradient(180deg,var(--bg),#081025);}
    .wrap{max-width:980px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px}
    h1{margin:0;font-size:1.5rem}
    .sub{color:var(--muted);font-size:0.95rem}
    .board{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:18px}
    @media (max-width:880px){.board{grid-template-columns:1fr;}.sidebar{order:2}}
    .play-area{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .field{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:8px;padding:12px;min-height:360px;position:relative}
    .lane{display:flex;align-items:center;gap:12px;padding:12px;border-radius:8px;background:var(--glass);margin-bottom:10px}
    .lane .person{width:64px;height:64px;border-radius:8px;background:linear-gradient(135deg,#071027,#0b2340);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);font-size:1.1rem}
    .lane .desc{flex:1}
    .resource-pool{display:flex;gap:10px;flex-wrap:wrap;padding-top:10px}
    .resource{padding:10px 12px;border-radius:8px;background:#05111a;border:1px solid rgba(255,255,255,0.02);cursor:pointer;user-select:none}
    .resource.dragging{opacity:0.6;transform:scale(1.02)}
    .sidebar{background:var(--card);padding:16px;border-radius:12px;height:100%}
    .score{font-size:1rem;margin-bottom:10px}
    .controls{display:flex;gap:8px;margin-top:10px}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:10px;color:var(--accent);cursor:pointer}
    button.secondary{color:var(--muted);border-style:dashed}
    footer{margin-top:16px;color:var(--muted);font-size:0.9rem}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:30px;padding:10px 14px;border-radius:10px;background:#022635;color:#dff6ff;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:0.85rem}
    .modal{position:fixed;inset:0;background:linear-gradient(180deg,rgba(2,6,23,0.6),rgba(2,6,23,0.9));display:flex;align-items:center;justify-content:center;padding:20px}
    .modal-card{background:linear-gradient(180deg,#071025,#042034);padding:18px;border-radius:12px;max-width:720px;width:100%;color:#e6eef6}
    .hidden{display:none}
    /* accessibility focus */
    .resource:focus{outline:3px solid rgba(125,211,252,0.16)}
    .lane.highlight{box-shadow:inset 0 0 0 2px rgba(125,211,252,0.06)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Juego: Igualdad de Oportunidades</h1>
        <div class="sub">Asigna recursos para que cada persona llegue a la meta. ¬øIgualdad o equidad?</div>
      </div>
    </header>

    <div class="board">
      <div class="play-area">
        <div class="field" id="field" aria-label="√Årea de juego">
          <!-- dynamic lanes -->
        </div>

        <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
          <div class="legend" aria-hidden>
            <div class="chip">Meta üéØ: 100 puntos</div>
            <div class="chip">Recurso: ayuda, beca, rampa, tutor</div>
          </div>
          <div style="color:var(--muted);font-size:0.95rem">Consejo: arrastra o usa teclado (Tab + Enter) para asignar</div>
        </div>
      </div>

      <aside class="sidebar">
        <div class="score"><strong>Puntuaci√≥n:</strong> <span id="score">0</span></div>
        <div><strong>Recursos disponibles</strong></div>
        <div class="resource-pool" id="pool" role="list">
          <!-- resources -->
        </div>

        <div class="controls">
          <button id="resetBtn">Reiniciar</button>
          <button class="secondary" id="explainBtn">¬øC√≥mo jugar?</button>
        </div>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">
        <div style="font-size:0.95rem;color:var(--muted)"><strong>Objetivo:</strong> Aprende la diferencia entre <em>igualdad</em> (dar lo mismo a todos) y <em>equidad</em> (dar lo que cada uno necesita) para alcanzar la meta.</div>
        <footer>
          <div style="margin-top:10px">Hecho con ‚ù§Ô∏è ‚Äî Puedes subir <code>index.html</code> a GitHub Pages para publicarlo.</div>
        </footer>
      </aside>
    </div>
  </div>

  <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>

  <div id="modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card">
      <h2>C√≥mo jugar</h2>
      <p>En la izquierda ver√°s personas con diferentes barreras. Arrastra los recursos desde la 'piscina' a las personas para que superen la barrera y lleguen a la meta (100 puntos).</p>
      <ul>
        <li><strong>Igualdad</strong>: dar la misma ayuda a todos puede no ser suficiente.</li>
        <li><strong>Equidad</strong>: dar m√°s ayuda a quien la necesita menos puede resultar en mejores resultados globales.</li>
      </ul>
      <p>Puedes reiniciar y probar distintas estrategias. ¬°Intenta maximizar la puntuaci√≥n total!</p>
      <div style="display:flex;justify-content:flex-end;margin-top:12px"><button id="closeModal">Cerrar</button></div>
    </div>
  </div>

  <script>
    // --- Data model ---
    const people = [
      { id: 'p1', name: 'Ana', barrier: 70, note: 'Zona rural ‚Äî transporte limitado' },
      { id: 'p2', name: 'Luis', barrier: 50, note: 'Sin estudios formales ‚Äî acceso a empleo dif√≠cil' },
      { id: 'p3', name: 'Marta', barrier: 30, note: 'Cuida a su familia ‚Äî tiempo limitado' }
    ];

    const resourceTypes = [
      { id:'r1', name:'Beca', value:40, desc:'Apoyo econ√≥mico para estudios' },
      { id:'r2', name:'Transporte', value:30, desc:'Viajes para llegar a oportunidades' },
      { id:'r3', name:'Tutor', value:25, desc:'Acompa√±amiento educativo' },
      { id:'r4', name:'Rampa', value:20, desc:'Adaptaci√≥n o acceso f√≠sico' }
    ];

    // initial pool: two of each
    let pool = [];
    resourceTypes.forEach(rt=>{pool.push({...rt, uid: rt.id+'a'}); pool.push({...rt, uid: rt.id+'b'});});

    // assigned resources map personId -> array
    const assigned = {};
    people.forEach(p=>assigned[p.id]=[]);

    // --- DOM refs ---
    const field = document.getElementById('field');
    const poolEl = document.getElementById('pool');
    const scoreEl = document.getElementById('score');
    const toast = document.getElementById('toast');

    // render lanes and pool
    function render(){
      field.innerHTML = '';
      people.forEach(p=>{
        const lane = document.createElement('div'); lane.className='lane'; lane.tabIndex=0;
        lane.dataset.pid = p.id;
        const person = document.createElement('div'); person.className='person'; person.textContent=p.name[0];
        const desc = document.createElement('div'); desc.className='desc';
        desc.innerHTML = `<strong>${p.name}</strong><div style="color:var(--muted);font-size:0.9rem">${p.note}</div><div style="margin-top:6px">Barreras: <span data-bar>${p.barrier}</span></div><div style="margin-top:6px">Asignado: <span data-assigned>0</span></div>`;
        const assignedContainer = document.createElement('div'); assignedContainer.className='assigned-list'; assignedContainer.style.marginLeft='8px';
        lane.appendChild(person); lane.appendChild(desc);

        // drop target behavior
        lane.addEventListener('dragover', e=>{e.preventDefault(); lane.classList.add('highlight');});
        lane.addEventListener('dragleave', e=>{lane.classList.remove('highlight');});
        lane.addEventListener('drop', e=>{lane.classList.remove('highlight'); const uid = e.dataTransfer.getData('text/plain'); handleAssign(uid,p.id);});

        // keyboard: Enter to open quick assign menu
        lane.addEventListener('keydown', e=>{ if(e.key==='Enter'){ showAssignMenu(p.id); } });

        field.appendChild(lane);
      });

      renderPool();
      updateScore();
    }

    function renderPool(){
      poolEl.innerHTML='';
      pool.forEach(item=>{
        const r = document.createElement('div'); r.className='resource'; r.draggable=true; r.tabIndex=0;
        r.textContent = item.name + ' (+'.concat(item.value,')');
        r.dataset.uid = item.uid;
        r.title = item.desc;
        r.addEventListener('dragstart', e=>{e.dataTransfer.setData('text/plain', item.uid); r.classList.add('dragging');});
        r.addEventListener('dragend', e=>{r.classList.remove('dragging');});
        // keyboard assign: space/enter to pick and then choose person
        r.addEventListener('keydown', e=>{ if(e.key==='Enter' || e.key===' '){ keyboardPick(item.uid); e.preventDefault(); } });
        poolEl.appendChild(r);
      });
      if(pool.length===0){ poolEl.innerHTML='<div style="color:var(--muted)">Sin recursos disponibles</div>' }
    }

    function handleAssign(uid, pid){
      // find resource
      const idx = pool.findIndex(it=>it.uid===uid);
      if(idx===-1){ showToast('Recurso inv√°lido'); return; }
      const item = pool.splice(idx,1)[0];
      assigned[pid].push(item);
      showToast(`Asignaste ${item.name} a ${people.find(p=>p.id===pid).name}`);
      render();
    }

    function updateScore(){
      let total = 0;
      people.forEach(p=>{
        const sum = assigned[p.id].reduce((s,r)=>s+r.value,0);
        const achieved = Math.min(100, sum + (100 - p.barrier));
        // formula: if sum >= barrierReduction -> counts. We'll award proportionally.
        const personScore = Math.max(0, Math.min(100, sum >= p.barrier ? 100 : Math.round((sum / p.barrier) * 100)));
        total += personScore;
        // update lane assigned view
        const lane = document.querySelector(`.lane[data-pid='${p.id}']`);
        if(lane){ lane.querySelector('[data-assigned]').textContent = sum; lane.querySelector('[data-bar]').textContent = p.barrier; }
      });
      scoreEl.textContent = total;
    }

    function showToast(msg, duration=2200){
      toast.textContent = msg; toast.classList.remove('hidden');
      setTimeout(()=>{ toast.classList.add('hidden'); }, duration);
    }

    // keyboard flow for picking resource then person
    let keyboardPicked = null;
    function keyboardPick(uid){ keyboardPicked = uid; showToast('Recurso seleccionado. Presiona Enter en la persona para asignar.'); }
    function showAssignMenu(pid){ if(keyboardPicked){ handleAssign(keyboardPicked, pid); keyboardPicked=null; } else { showToast('Primero selecciona un recurso (Tab + Enter sobre un recurso).'); } }

    // quick assign menu alternative
    function showModal(text){ const modal = document.getElementById('modal'); modal.querySelector('.modal-card p')?.remove(); modal.classList.remove('hidden'); }

    // reset
    function resetAll(){ pool = []; resourceTypes.forEach(rt=>{pool.push({...rt, uid: rt.id+'a'}); pool.push({...rt, uid: rt.id+'b'});});
      people.forEach(p=>assigned[p.id]=[]); render(); showToast('Reiniciado. Prueba otra estrategia.'); }

    // assign menu for accessibility (select a resource from pool programmatically)
    function showAssignMenu(pid){
      // try to find a resource to assign automatically (use the largest first as default)
      if(pool.length===0){ showToast('No hay recursos'); return; }
      // find largest
      const bestIdx = pool.reduce((best,i,idx)=> i.value > pool[best].value ? idx : best, 0);
      handleAssign(pool[bestIdx].uid, pid);
    }

    // keyboard path already handled

    // initial render
    render();

    // buttons
    document.getElementById('resetBtn').addEventListener('click', resetAll);
    document.getElementById('explainBtn').addEventListener('click', ()=>{ document.getElementById('modal').classList.remove('hidden'); });
    document.getElementById('closeModal').addEventListener('click', ()=>{ document.getElementById('modal').classList.add('hidden'); });

    // extras: simple scoring tip and end state
    setInterval(()=>{
      updateScore();
      const total = parseInt(scoreEl.textContent,10);
      if(total >= 300){ showToast('¬°Has alcanzado un resultado excelente!'); }
    },1500);

    // keyboard: support delete assigned by double-click on lane
    field.addEventListener('dblclick', e=>{
      const lane = e.target.closest('.lane'); if(!lane) return; const pid = lane.dataset.pid;
      if(assigned[pid].length>0){ pool.push(...assigned[pid]); assigned[pid]=[]; render(); showToast('Recursos retirados y devueltos a la piscina'); }
    });

    // small accessibility improvement: announce when resources change
    const obs = new MutationObserver(()=>{ /* noop - left for future a11y hooks */ });
    obs.observe(poolEl,{childList:true,subtree:true});

    // start state: a helpful toast
    showToast('Bienvenido: arrastra recursos a las personas. Doble clic en una persona retira recursos.');
  </script>
</body>
</html>
